<?xml version="1.0" encoding="UTF-8"?>
<!--
    ============================================
    COMLINK SEO-FRIENDLY URL CONFIGURATION
    IIS Server (web.config)
    ============================================

    Bu dosya Windows IIS sunucularında kullanılacak.
    Deployment öncesi "web.config" olarak rename edilmelidir.
    Development ortamında bu dosya devre dışıdır.

    NOT: IIS URL Rewrite modülü yüklü olmalıdır.
-->
<configuration>
    <system.webServer>

        <!-- ==================== URL REWRITE MODULE ==================== -->
        <rewrite>
            <rules>

                <!-- 1. index.html'i gizle (ana sayfa) -->
                <rule name="Remove index.html" stopProcessing="true">
                    <match url="^(.*)index\.html$" ignoreCase="true" />
                    <action type="Redirect" url="{R:1}" redirectType="Permanent" />
                </rule>

                <!-- 2. .html uzantılarını gizle -->
                <rule name="Remove .html extension" stopProcessing="true">
                    <match url="^(.*)\.(html)$" ignoreCase="true" />
                    <conditions>
                        <add input="{REQUEST_METHOD}" pattern="^GET$" />
                    </conditions>
                    <action type="Redirect" url="{R:1}" redirectType="Permanent" />
                </rule>

                <!-- 3. .html uzantısı olmadan istek geldiğinde .html dosyasını sun -->
                <rule name="Add .html extension" stopProcessing="true">
                    <match url="^([^/]+)/?$" ignoreCase="true" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
                        <add input="{REQUEST_FILENAME}.html" matchType="IsFile" />
                    </conditions>
                    <action type="Rewrite" url="{R:1}.html" />
                </rule>

                <!-- 4. Blog detay sayfası: /blog/slug-name -->
                <rule name="Blog Detail Page" stopProcessing="true">
                    <match url="^blog/([a-zA-Z0-9\-]+)/?$" ignoreCase="true" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
                    </conditions>
                    <action type="Rewrite" url="blog-details.html?id={R:1}" appendQueryString="true" />
                </rule>

                <!-- 5. Ürün detay sayfası: /urun/product-slug -->
                <rule name="Product Detail Page" stopProcessing="true">
                    <match url="^urun/([a-zA-Z0-9\-]+)/?$" ignoreCase="true" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
                    </conditions>
                    <action type="Rewrite" url="urun-detay.html?id={R:1}" appendQueryString="true" />
                </rule>

                <!-- 6. Kategori sayfası: /kategori/category-slug -->
                <rule name="Product Category Page" stopProcessing="true">
                    <match url="^kategori/([a-zA-Z0-9\-]+)/?$" ignoreCase="true" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
                    </conditions>
                    <action type="Rewrite" url="urunler.html?kategori={R:1}" appendQueryString="true" />
                </rule>

                <!-- 7. HTTPS Redirect (SSL sertifikası varsa aktif et) -->
                <!--
                <rule name="Redirect to HTTPS" stopProcessing="true">
                    <match url="(.*)" />
                    <conditions>
                        <add input="{HTTPS}" pattern="off" ignoreCase="true" />
                    </conditions>
                    <action type="Redirect" url="https://{HTTP_HOST}{REQUEST_URI}" redirectType="Permanent" />
                </rule>
                -->

                <!-- 6. WWW Redirect (İsteğe Bağlı) -->
                <!-- www eklemek için -->
                <!--
                <rule name="Add WWW" stopProcessing="true">
                    <match url="(.*)" />
                    <conditions>
                        <add input="{HTTP_HOST}" pattern="^www\." negate="true" />
                    </conditions>
                    <action type="Redirect" url="https://www.{HTTP_HOST}/{R:0}" redirectType="Permanent" />
                </rule>
                -->

                <!-- www kaldırmak için -->
                <!--
                <rule name="Remove WWW" stopProcessing="true">
                    <match url="(.*)" />
                    <conditions>
                        <add input="{HTTP_HOST}" pattern="^www\.(.*)$" />
                    </conditions>
                    <action type="Redirect" url="https://{C:1}/{R:0}" redirectType="Permanent" />
                </rule>
                -->

            </rules>
        </rewrite>

        <!-- ==================== DEFAULT DOCUMENT ==================== -->
        <defaultDocument>
            <files>
                <clear />
                <add value="index.html" />
                <add value="default.html" />
            </files>
        </defaultDocument>

        <!-- ==================== STATIC CONTENT CACHING ==================== -->
        <staticContent>
            <clientCache cacheControlMode="UseMaxAge" cacheControlMaxAge="30.00:00:00" />

            <!-- MIME Types -->
            <remove fileExtension=".woff" />
            <mimeMap fileExtension=".woff" mimeType="application/font-woff" />
            <remove fileExtension=".woff2" />
            <mimeMap fileExtension=".woff2" mimeType="application/font-woff2" />
            <remove fileExtension=".json" />
            <mimeMap fileExtension=".json" mimeType="application/json" />
            <remove fileExtension=".svg" />
            <mimeMap fileExtension=".svg" mimeType="image/svg+xml" />
        </staticContent>

        <!-- ==================== COMPRESSION ==================== -->
        <urlCompression doStaticCompression="true" doDynamicCompression="true" />

        <!-- ==================== HTTP COMPRESSION ==================== -->
        <httpCompression>
            <scheme name="gzip" dll="%Windir%\system32\inetsrv\gzip.dll" />
            <staticTypes>
                <add mimeType="text/*" enabled="true" />
                <add mimeType="message/*" enabled="true" />
                <add mimeType="application/javascript" enabled="true" />
                <add mimeType="application/json" enabled="true" />
                <add mimeType="*/*" enabled="false" />
            </staticTypes>
            <dynamicTypes>
                <add mimeType="text/*" enabled="true" />
                <add mimeType="message/*" enabled="true" />
                <add mimeType="application/javascript" enabled="true" />
                <add mimeType="*/*" enabled="false" />
            </dynamicTypes>
        </httpCompression>

        <!-- ==================== SECURITY HEADERS ==================== -->
        <httpProtocol>
            <customHeaders>
                <add name="X-Content-Type-Options" value="nosniff" />
                <add name="X-Frame-Options" value="SAMEORIGIN" />
                <add name="X-XSS-Protection" value="1; mode=block" />
            </customHeaders>
        </httpProtocol>

        <!-- ==================== DIRECTORY BROWSING ==================== -->
        <directoryBrowse enabled="false" />

    </system.webServer>
</configuration>
